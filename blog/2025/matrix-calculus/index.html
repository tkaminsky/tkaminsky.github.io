<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Matrix Calculus; Or, Throw Away The Matrix Cookbook! | Thomas Kaminsky </title> <meta name="author" content="Thomas Kaminsky"> <meta name="description" content="A brief, non-technical explainer on performing vectorized differentiation."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a26b1b0e2d9c9dd2e5ed17c987a37731"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?9dbe0c76bacd463500b79ed6a86e27ac"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/logo.svg?fc378453328c0e5193f1b19498e19c64"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tkaminsky.github.io/blog/2025/matrix-calculus/"> <script src="/assets/js/theme.js?bd888c560287cd675855c7662a167c4a"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}};</script> <script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Thomas Kaminsky </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Matrix Calculus; Or, Throw Away The Matrix Cookbook!</h1> <p class="post-meta"> Created in May 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/calculus"> <i class="fa-solid fa-hashtag fa-sm"></i> calculus</a>   <a href="/blog/tag/linear-algebra"> <i class="fa-solid fa-hashtag fa-sm"></i> linear-algebra</a>   <a href="/blog/tag/matrix-calculus"> <i class="fa-solid fa-hashtag fa-sm"></i> matrix-calculus</a>   ·   <a href="/blog/category/math"> <i class="fa-solid fa-tag fa-sm"></i> math</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <style>.center-box{background-color:#ccc;padding:20px;text-align:center;border-radius:8px;width:50%}</style> <p>Over winter break, I spent some time watching Prof. <a href="https://math.mit.edu/~edelman/" rel="external nofollow noopener" target="_blank">Alan Edelman</a> and Prof. <a href="https://math.mit.edu/~stevenj/" rel="external nofollow noopener" target="_blank">Steven G. Johnson</a>’s course on <a href="https://ocw.mit.edu/courses/18-s096-matrix-calculus-for-machine-learning-and-beyond-january-iap-2023/" rel="external nofollow noopener" target="_blank">Matrix Calculus</a>. It was an IAP course at MIT, which I think means that it was taught informally to a broad audience over a shorter time-span. I’ve been looking for a course like this for a while——calculus had been a pain point for me for a while, and I found that analysis and algebra didn’t do much to help me out. To give some illustrative examples, here are some questions that troubled me throughout my high school, college, and graduate studies:</p> <ol> <li>I studied stats, and we’d often encounter problems whose solution was the total derivative of a function from vectors to scalars. This is fine, but often applying the ‘chain rule’ would require calculating derivatives of matrix terms as an intermediate step, which I never understood. Basically every derivative would end up being some stack of partials so it wasn’t mechanically hard to find, but I could never remember whether it should be transposed, how the dimensions worked out, or why we were even allowed to do this.</li> <li>On that note, it has never even been clear to me what $df/dA$ even <strong>is</strong> when $A$ is a matrix! Is it just a huge dictionary of partial derivatives? Does it have a ‘shape’? Can we ‘multiply’ it with other things?</li> <li>I really hate working with indices! I always get them mixed up, and even if I don’t, excessive indexing makes calculations tedious and error-prone. In general, I’m a firm believer that mathematical ‘broccoli’—stuff that you have to do to get where you want to go, but which causes no joy in the doing—should be avoided whenever possible. Yet how many times have I had to unpack three or four sums to differentiate an expression that can just be written as some compact matrix product?</li> <li>To step back all the way to high school, what in the world is implicit differentiation? Why does the chain rule require you to ‘multiply by the derivative of the inside’? Why can you sometimes treat $df/dx$ as a fraction, and sometimes not?</li> <li>What is a Jacobian? What is a derivative? What is a gradient? What is a partial derivative? Why do all of these things have different names, and why do they have different shapes? Why do I constantly have to transpose the gradient for it to do anything interesting?</li> </ol> <p>I think that the intuition of matrix calculus helps answer all of these questions in a pretty satisfying way. It’s helped me reduce my reliance on <a href="https://www.math.uwaterloo.ca/~hwolkowi/matrixcookbook.pdf" rel="external nofollow noopener" target="_blank">The Matrix Cookbook</a> and other tools, and it’s really tightened my understanding of both linear algebra and calculus. The course itself covers a fair amount of content that isn’t directly connected to this theme, and because its audience had a variety of mathematical backgrounds, it sometimes goes through a lot of concepts that more experienced students may be comfortable skipping. Thus, I’ve decided to write a brief explainer covering my major takeaways from the course, as well as a few interesting examples.</p> <p>Here’s a list of topics covered for reference:</p> <h3 id="table-of-contents">Table of Contents</h3> <ul> <li> <strong><a href="#part-i--differentials-and-derivatives">Part I: Differentials and Derivatives</a></strong> <ul> <li><em><a href="#differences-of-functions">Differences of Functions</a></em></li> <li><em><a href="#differentials-and-differentiability">Differentials and Differentiability</a></em></li> <li><em><a href="#derivatives-of-linear-functions">Derivatives of Linear Functions</a></em></li> </ul> </li> <li> <strong><a href="#part-ii--the-chain-and-product-rules">Part II: The Chain and Product Rules</a></strong> <ul> <li><em><a href="#application--elementwise-functions">Elementwise Functions</a></em></li> <li><em><a href="#application--matrix-inverse">Matrix Inverses</a></em></li> </ul> </li> <li> <strong><a href="#part-iii--tricky-derivatives">Part III: Tricky Derivatives</a></strong> <ul> <li><em><a href="#the-determinant">Determinants</a></em></li> <li><em><a href="#matrix-powers">Matrix Powers</a></em></li> </ul> </li> <li> <strong><a href="#part-iv--insights-about-the-world">Part IV : Insights About the World</a></strong> <ul> <li><em><a href="#gradients-via-inner-products">Gradients via Inner Products</a></em></li> <li><em><a href="#matrix-gradient-ascent">Matrix Gradient Ascent</a></em></li> <li><em><a href="#kronecker-products">Kronecker Products</a></em></li> <li><em><a href="#implicit-differentiation">Implicit Differentiation</a></em></li> </ul> </li> </ul> <h1 id="part-i--differentials-and-derivatives">Part I : Differentials and Derivatives</h1> <p>To start the process of developing matrix calculus, we need to be clear about what we mean by a ‘derivative’. To appreciate how hard this could be, recognize that, in different contexts, the derivative could be thought of as any of the following:</p> <ul> <li>The slope of the line tangent to $x$.</li> <li>The instantaneous rate at which $f(x)$ is increasing at $x$.</li> <li>The direction of steepest ascent of $f$ (for functions $f: \mathbb{R}^n \to \mathbb{R}$——the ‘gradient’)</li> <li>The matrix whose $(i,j)$-th entry is the change of the $i$-th entry of $f$ with respect to the $j$-th entry of $x$, in the sense of the first two definitions (for functions $f: \mathbb{R}^n \to \mathbb{R}$).</li> <li>etc. etc. etc.</li> </ul> <p>If you’ve taken a multivariable calculus class, you probably know some form of the following statement, which is in some sense the most satisfying summary of all these interpretations:</p> <p><strong>The derivative of a function at $x$ is its <em>best linear approximation</em> at $x$</strong>.</p> <p>More strongly, we think that the derivative provides a basically <em>perfect</em> linear approximation, so long as we’re really close to $x$. This intuition remains correct throughout the blog post, but we are going to add some additional structure to make it as explicit and organized of a notion as possible.</p> <h3 id="differences-of-functions">Differences of Functions</h3> <p>To start, let’s say that we have some $x$ that we care about, and we want to see how $f(x)$ changes when you perturb it——say, by some amount $\Delta x$. Then a natural quantity to consider would be the difference between the perturbed and the original input. Let’s call this $\Delta f$:</p> \[\Delta f \triangleq f(x + \Delta x) - f(x).\] <p>Let’s play this game with a concrete function as an example: $f(x) = 4x^2-3x+1$. We find</p> \[\Delta f = f(x + \Delta x) - f(x) = 4(x+ \Delta x)^2-3(x+\Delta x)+1 -4x^2+3x-1\] \[=4x^2 + 8 x \Delta x + 4\Delta x^2 - 3x - 3 \Delta x + 1 - 4x^2 + 3x - 1\] \[= 8x \Delta x - 3 \Delta x + 4\Delta x^2\] \[= (8x - 3) \Delta x + 4\Delta x^2.\] <p>A few things immediately jump out. First, assuming that we hold $x$ constant, notice that we’ve constructed a <em>function</em> from input space to output space. That is,</p> \[\Delta f : \mathbb{R} \to \mathbb{R} \;\; \text{ is given by } \;\; \Delta f (\Delta x) = (8x - 3) \Delta x + 4\Delta x^2.\] <p>So $\Delta f$ is just the name of a function (like $f$), and $\Delta x$ is the name of its input. This is true no matter what we plug in for $\Delta x$; it doesn’t need to be <em>infinitesimal</em>, or even particularly small! Let’s say for example that $x = 0$. If I plug in $\Delta x = 5$, I get</p> \[\Delta f(5) = -3 (5) + 4 \cdot 5^2 = 100 - 15 = 85.\] <p>If I compare this to $f(5) - f(0)$ explicitly, I also get that</p> \[f(5) - f(0) = (100 - 15 + 1) - 1 = 85.\] <p>So we see that $\Delta f$ gives us exactly the change in $f$ from $f(x)$ when we change the input from $x$ to $x + \Delta x$! Moreover, just as a sanity check, notice that $\Delta f + f(x)$ gives us</p> \[\Delta f + f(x) = (8x - 3) \Delta x + 4\Delta x^2 + 4x^2 - 3x + 1\] \[= 1 - 3 (x + \Delta x) + 4 (\Delta x^2 + 2 x \Delta x + x^2) = 1 - 3 (x+\Delta x) + 4 (x + \Delta x)^2.\] <p>So we see that $\Delta f + f(x)$ is just $f$, reparametrized so that $\Delta x$ is our input instead, and so we’re now centering our function at $\Delta x = 0$ instead of $x = 0$!</p> <p>We can do this for any function, and we’ll get a corresponding function that exactly captures the change in $f$. It might not be so easy to write in a simple way (e.g. $f(x) = \sin(x) + \cos(x)$), but there’s nothing stopping us from defining it in principle.</p> <h3 id="differentials-and-differentiability">Differentials and Differentiability</h3> <p>However, you might notice that, at least in the example above, if $\Delta x$ <em>is</em> small, then some of these terms don’t matter. In particular, $\Delta x^2$ goes to $0$ way faster than $\Delta x$ does (e.g., if $\Delta x = 10^{-5}$, then $\Delta x = 10^{-10}$—only $.001\%$ of $\Delta x$!). Then if we choose some really tiny $\Delta x$, which we’ll call $dx$, then the corresponding tiny $\Delta f$ (which we’ll likewise call $d f$), is approximately given by</p> \[df \approx (8x - 3) dx.\] <p>I tend to think of the terms $df$ and $dx$, which we’ll call <em>differentials</em>, intuitively rather than formally, as some small vectors with nearly negligable norm (and negligable squared norm). But you can also think about $dx$ as just another name for $\Delta x$ indicating that it’s small, and $df$ as the ‘leading term’ in $\Delta f$—that is, a quantity satisfying</p> \[\Delta f = df + o(||dx||),\] <p>where \(o(\norm{dx})\) is any function such that</p> \[\underset{||dx|| \to 0}{\lim} \frac{o(||dx||)}{||dx||} = 0.\] <p>Then intuitively, we’d like for this $df$ to look basically like $\Delta f$ when $dx$ is small. We can formalize this to get at the notion of <em>differentiability</em> explicitly:</p> <hr> <h4 id="definition-differentiability"><strong>Definition (Differentiability).</strong></h4> <p>Let $f : V \to W$ be some function between two normed vector spaces, each with a corresponding metric \(\norm{\cdot}_V, \norm{\cdot}_W\). We say that $f$ is <em>differentiable</em> at $x \in V$ if there exists some linear function $D_{f \leftarrow x} : V \to W$ such that</p> \[\underset{\norm{\Delta x}_V \to \mathbf{0}}{\text{lim}} f(x+ \Delta x) - f(x) \triangleq df = D_{f \leftarrow x}[d x].\] <p>We call the linear operator $D_{f \leftarrow x}$ the <em>derivative</em> of $f$ with respect to $x$. You might also know it as $\frac{df}{dx}$, $J$, $\nabla_x f$, and so on. Note also that, when this linear transformation is a matrix, vector, or scalar, we might overload notation by also referring to the associated matrix/vector/scalar of transformation as the derivative.</p> <hr> <ul> <li><em>Note : I like this notation $D_{f \leftarrow x}$, even though I don’t really see it used often. It emphasizes that $D$ is just some linear transformation, which takes $x$ points to $f$ points. The reversed arrow direction is intended to make the chain rule more obvious, as we’ll be composing linear transformations soon (see <a href="#the-chain-and-product-rules">the chain rule section</a>).</em></li> </ul> <p>Recall that, if $V = \mathbb{R}^n$ and $W= \mathbb{R}^m$ for some $n,m$, then it must be possible to write $D_{x \to f}$ as a matrix product with $\Delta x$. This is going to turn out to be the familiar <em>Jacobian</em> from multivariable calculus.</p> <p>Let’s get more familiar with this idea through a few simple examples.</p> <h5 id="example-1-vt-x">Example 1: $v^T x$.</h5> <p>Let $f: \mathbb{R}^n \to \mathbb{R}$ be given by $f(x) = v^T x$ for some constant vector $v$. Then</p> \[f(x + dx) - f(x) = v^T(x + dx) - v^T x = v^T dx.\] <p>So we can say that $D_{f \leftarrow x} = v^T$. Note that, oddly enough, we find that</p> \[df = f(dx).\] <p>We also see that, if we had computed $\nabla f$ explicitly, we would’ve found $\nabla f = v$. Then we also have $df = \nabla f ^T dx$.</p> <h5 id="example-2-xt-x">Example 2: $x^T x$.</h5> <p>Let’s look at a slightly more complicated function: $f(x) = x^T x$. We see that</p> \[df = f(x + dx) - f(x) = (x + dx)^T (x+dx) - x^T x = x^T x + 2 x^T dx + dx^T dx - x^T x\] \[= 2x^T dx + 0,\] <p>since we established that $dx^T dx = \norm{dx}^2$ is negligable. Notice also that $D_{f \leftarrow x} = \nabla f^T = 2x^T$ in this case, so we again get that $df = \nabla f^T dx$!</p> <h5 id="example-3-ax">Example 3: $Ax$</h5> <p>Let $f: \mathbb{R}^n \to \mathbb{R}^m$ be given by $f(x) = Ax$. Then</p> \[df = A(x + dx) - A(x) = A(dx).\] <p>Once again, you’ll notice that $df = f(dx)$, and now $D_{f \leftarrow x} = A$, which is the jacobian of $f$! We can actually extend this result to an arbitrary linear function with ease:</p> <h3 id="derivatives-of-linear-functions">Derivatives of Linear Functions</h3> <hr> <h4 id="theorem-derivative-of-linear-functions"><strong>Theorem (Derivative of Linear Functions)</strong></h4> <p>For any linear function $T : V \to V$,</p> \[dT = T(dx).\] <hr> <p><em>Proof.</em></p> <p>By linearity,</p> \[dT = T(x + dx) - T(x) = T(x) - T(x) + T(dx) = T(dx). \blacksquare\] <p>Though this may seem like a simple result, it actually comes in really handy for a ton of problems. For example, here are some linear functions that come up often in practice:</p> <ul> <li>$\text{diag}(x)$, the matrix whose $(i,i)$-th entry is $x_i$, and all other entries 0.</li> <li>$\text{tr}(A)$, the sum of the diagonal entries $\sum_{i=1}^n A_{ii}$.</li> <li>The transpose operator $X^T$, or more generally permutations of indices of matrices or vectors.</li> <li>The ‘index-into’ function $[A]_{ij}$, which picks out an entry from a matrix.</li> <li>Most generally, any matrix-to-matrix function whose elements are linear functions of the input matrix’s elements.</li> </ul> <p>Let’s show this last one explicitly, just because it’s easy and covers a ton of cases (including every one of the above).</p> <p>Say \([M(X)]_{ij} = T_{ij}(X)\). for some linear functions \(\{ T_{ij}\}\). Then</p> \[[M(cX + Y)]_{ij} = T_{ij}(cX + Y) = c T_{ij}(X) + T_{ij}(Y)\] \[= c [M(X)]_{ij} + [M(Y)]_{ij},\] <p>so $M(cX+Y) = cM(X) + M(Y).$</p> <p>Thus, we see that it’s linear, and so the above theorem applies. $\blacksquare$</p> <h1 id="part-ii--the-chain-and-product-rules">Part II : The Chain and Product Rules</h1> <p>All of this manual differentiation is pretty tedius, and it will become harder to do as we begin to tackle more complicated functions. As such, we should develop some general rules for performing differentiation, as in single-variable calculus. The easiest to show is the chain rule:</p> <hr> <h4 id="theorem-chain-rule"><strong>Theorem (Chain Rule)</strong></h4> <p>If $g : U \to V$, $f: V \to W$, and $h : U \to W$ is given by $h(x) = f(g(x))$, then</p> \[dh = D_{f \leftarrow g}[D_{g \leftarrow x}[dx]].\] <p>In particular, if $U,V,$ and $W$ are all spaces of real vectors, then their derivatives $D_{x \leftarrow g}$ and $D_{g \leftarrow f}$ are matrices, and so</p> \[dh = D_{f \leftarrow g} D_{g \leftarrow x} dx.\] <hr> <p><em>Proof.</em></p> <p>Consider first $g(x+dx)$. Note that</p> \[g(x+dx) = g(x+dx) - g(x) + g(x) = dg + g.\] <p>Then</p> \[dh = f(g(x + dx)) - f(g(x))\] \[= f(dg + g) - f(g) = D_{f \leftarrow g}[dg] = D_{f \leftarrow g}[D_{f \leftarrow x}[dx]]\] <p>by the definition of a differential. $\blacksquare$</p> <p>This has a really intuitive interpretation—the linear transformation that takes $dx$ to $dh$ is just the transformation that takes $dx$ to $dg$, followed by that taking $dg$ to $dh$ ($df$). This also helps us recognize that differentials behave really nicely: if you ever have some differential $df$ in an expression, you can always just substitute in any defined $D_{f \leftarrow g}[dg]$ to change variables.</p> <p>Next, let’s prove the product rule:</p> <hr> <h4 id="theorem-product-rule"><strong>Theorem (Product Rule)</strong></h4> <p>Let $f,g : V \to W$, and $h :V \to W$ be given by $h = f(x) g(x)$. Then</p> \[dh = D_{f \leftarrow x}[dx] g(x) + f(x) D_{g \leftarrow x}[dx].\] <p>You’ll notice that including this dependence on $x$ is kind of ugly; and, by the chain rule, we know that we can transform any expression in terms of some $dg$ into an expression in terms of $dx$ by just plugging in the differential definition. Then for the rest of the post, let’s just repress the dependence on $x$, with the understanding that we can plug in $dx$’s whenever we want.</p> <p>This lets us rewrite the rule in a more simple form:</p> \[dh = df g + f dg.\] <hr> <ul> <li>Proof. *</li> </ul> \[dh = f(x + dx)g(x + dx) - f(x) g(x)\] \[= (df + f) (dg + g) - f g = df dg + f dg + df g + fg - fg\] \[= f dg + df g + df dg.\] <p>Finally, note that, since both $df$ and $dg$ have negligable square norm, so does $df dg$, as it also has norm of square order. Then</p> \[= f dg + df g + 0. \blacksquare\] <h3 id="application--matrix-inverse">Application : Matrix Inverse</h3> <p>We now show that these properties allow us to derive some more interesting derivatives. In particular, let</p> \[F = A^{-1}.\] <p>Then $AF = I$, so by the chain rule (and the fact that $dI = 0$),</p> \[d(AF) = dA F + A dF = 0\] \[\iff A dF = - dA F \iff dF = - A^{-1} dA A^{-1}.\] <h3 id="application--elementwise-functions">Application : Elementwise Functions</h3> <p>Now, let’s draw our attention to a popular set of functions. Namely, say that $F: \mathbb{R}^n \to \mathbb{R}^n$ is given by</p> \[[F(x)]_i = f(x_i) \; \forall i \in [n],\] <p>for some scalar function $f$. Then let’s compute its derivative. We have that</p> \[[F]_i = f,\] <p>so</p> \[[dF]_i = d[F_i] = df = \frac{df}{dx}(x_i) d x_i.\] <p>Thus, letting $\frac{df}{dx} = \left[\frac{df}{dx}(x_1), \dots, \frac{df}{dx}(x_n) \right]^T$, we find</p> \[dF = \frac{df}{dx} \odot dx = \text{diag} \left(\frac{df}{dx} \right) dx,\] <p>where $\odot$ is the Hadamard product (elementwise multiplication).</p> <h1 id="part-iii--tricky-derivatives">Part III : Tricky Derivatives</h1> <p>Though so far things have gone off mostly without a hitch, there’s still a fair amount of art to matrix calculus. Just as in normal calculus, we need to construct a few tough ‘rules’ for differentiating common functions, and then the chain and product rules will help us cover lots of others built up out of these pieces. The determinant and matrix powers are the next such ‘atomic rules’ for us to parse.</p> <h3 id="the-determinant">The Determinant</h3> <p>For this, we’ll use the definition of the determinant given below:</p> \[\text{det}(A) = \sum_{\sigma \in S_n} \text{sign}(\sigma) a_{1 \sigma(1)}\dots a_{n \sigma(n)}.\] <p>Consider in particular terms of the form $det(dA + \lambda I)$. We’re broadly interested in figuring out what terms in this determinant have linear $O(dA)$ terms, since higher-order terms will go to zero in the limit. To get us there, let’s first look at which terms in this big sum have $\lambda^n$? We need all $n$ diagonal elements, so the only one that works is $\sigma = \mathbf{1}$, so we find</p> \[\prod_i (dA_{ii} - \lambda) = \lambda^n + \lambda^{n-1} \sum_i dA_{ii} + \lambda^{n-2} \sum_i \sum_j dA_{ii} dA_{jj} + \dots\] <p>For any other permutation, at least two terms are purely $a_{ij}$ (since it’s impossible for only 1 index to be misplaced), meaning that it’s impossible to choose another term with only $dA^1$ terms.</p> <p>Then consider</p> \[\text{det}(I + dA).\] <p>As we showed above, this looks like</p> \[1^n + 1^{n-1} \text{tr}(dA) + [\text{terms involving } o(dA^2)].\] <p>Then</p> \[\text{det}(A+dA) = \text{det} (AI + AA^{-1} dA) = \text{det}(A)\text{det}(I + A^{-1} dA)\] <p>by properties of determinants,</p> \[= \text{det}(A)(1 + \text{tr}(A^{-1}dA)).\] <p>then</p> \[d[\text{det}(A)] = \text{tr}(\text{det(A)} A^{-1} dA).\] <h3 id="matrix-powers">Matrix Powers</h3> <p>Now, say that $F_n(A) = A^n$. We’ll solve this by induction.</p> <p>The chain rule gives us</p> <p>\(dA^2 = dA A + A dA = \sum_{i=0}^1 A^i dA A^{1-i}\).</p> <p>Assume for some $n$ that</p> \[dA^n = \sum_{i=0}^{n-1} A^i dA A^{n-1-i}.\] <p>Then by the chain rule,</p> \[dA^{n+1} = dA A^n + A d(A^n) = dA A^n + \sum_{i=0}^{n-1} A^{i+1} dA A^{(n+1) - 1 -i}\] \[= \sum_{i=0}^{(n+1) - 1} A^{i} dA A^{(n+1) - 1 -i},\] <p>as desired. $\blacksquare$</p> <p>There are other tricky derivative rules left to discover, but hopefully these are enough to get you started!</p> <h1 id="part-iv--insights-about-the-world">Part IV : Insights About the World</h1> <p>I want to spend the rest of this post unpacking some really nice inuition that this new formulation of the derivative gives us. Some of these ideas are really deep, while some are simple——the only common thread between all of them is that I think they’re cool, and help me understand something about math.</p> <h3 id="gradients-via-inner-products">Gradients via Inner Products</h3> <p>Let’s think about functions of the form $f(x) : \mathbb{R}^n \to \mathbb{R}$; so-called <em>functionals</em>. To look at these functions, recall this foundational theorem from linear algebra:</p> <hr> <h4 id="theorem-riesz-representation-theorem"><strong>Theorem (Riesz Representation Theorem)</strong></h4> <p>For any linear functional $F : V \to \mathbb{R}$ from real vector space $V$ equipped with inner product $\langle \cdot, \cdot \rangle$ to $\mathbb{R}$ there exists a unique $\phi \in V$ such that</p> \[F(x) = \langle \phi, x \rangle \: \forall x \in V.\] <hr> <p>This is a general fact (which extends way beyond real vector spaces), but it has a really nice implication for us. It turns out, we can actually define the gradient relative to this representation:</p> <hr> <h4 id="definition-gradient"><strong>Definition (Gradient)</strong></h4> <p>For a function $F : V \to \mathbb{R}$, the <em>gradient</em> at $x$ $\nabla F(x)$ is the unique vector in $V$ satisfying</p> \[dF = \langle \nabla F(x), dx \rangle.\] <hr> <p>This makes clear a lot of our examples from the first section, where derivatives seemed to be transposed gradients when we looked at functions from vectors to scalars.</p> <p>But it doesn’t stop there! Consider the function $F = \text{det}(A)$, which maps from matrices to scalars. Recall the Frobenius inner product $\langle A,B \rangle = \text{tr}(A^TB)$ We found in a previous section that</p> \[dF = \text{tr}(\text{det(A)} A^{-1} dA).\] <p>This lets us immediately find that</p> \[\nabla_A F = \text{det(A)} A^{-T}.\] <p>Moreover, this formulation allows us to perform gradient ascent/descent just like in the vector-valued case.</p> <h3 id="matrix-gradient-ascent">Matrix Gradient Ascent</h3> <p>Say that we’re at some point $x \in V$, and we seek to move in the direction where some function $F : V \to \mathbb{R}$ is increasing the quickest. If $V$ was some column vector, it’s already clear that this direction is given by the gradient. We now show that this remains true for any inner product space. Assume that $\norm{dx} = \epsilon$ is held constant, so we can just choose a maximizing direction to increase. Well, by the definition above, we find</p> \[dF = \langle \nabla F, dx \rangle,\] <p>so we seek</p> \[\underset{x}{\text{argmax}} \left\langle \nabla F, \epsilon\frac{x}{||x||} \right\rangle.\] <p>Well Cauchy-Schwarz says that this is maximized when $x$ points in the same direction as $\nabla F$!</p> <p>In fact, we can also recover the first-order necessary optimality conditions for constrained optimization in vector spaces of matrices and tensors.</p> <h3 id="kronecker-products">Kronecker Products</h3> <p>Recall the vector space isomorphism theorem——any vector space over the real numbers is isomorphic to some vector space $\mathbb{R}^n$. Well we can use this to make more exotic-looking derivatives into a more pallatable form.</p> <p>For instance, the MIT course emphasizes the following identity for transforming matrices into vectors:</p> \[(A \otimes B) \text{vec}(C) = \text{vec}(BCA^T),\] <p>where $\otimes$ is the <a href="https://en.wikipedia.org/wiki/Kronecker_product" rel="external nofollow noopener" target="_blank">Kronecker Product</a>. We can use this to turn ugly-looking matrix derivatives into nicer vector derivatives. For example, we saw that</p> \[d(A^TA) = dA^T A + A^T dA.\] <p>This could be annoying to work with, since the $dA$ shows up in two places. But by applying the identity, we find</p> \[dA^T A = I dA^T A = (A^T \otimes I) \text{vec}(dA^T) = (A^T \otimes I) P \text{vec}(dA)\] <p>for suitable permutation matrix $P$. Doing the same for the second term and combining yields</p> \[\text{vec}(d(A^TA)) = (A^T \otimes I) (P + I) \text{vec}(dA),\] <p>which makes our derivative a matrix, as desired.</p> <h3 id="implicit-differentiation">Implicit Differentiation</h3> <p>I was always really confused about why we could take expressions like</p> \[x^2 + y^2 = 1\] <p>and calculate ‘derivatives’ like this:</p> \[2x dx + 2y dy = 1 \iff \frac{dy}{dx} = - \frac{x}{y},\] <p>so-called ‘implicit’ differentiation. I think I’ve seen a proof before, but nothing that stuck with me. This linear transformation framing makes it really obvious what’s going on. We ALWAYS have</p> \[dx^2 = 2x dx\] <p>and</p> \[dy^2 = 2y dy,\] <p>(and of course $d1 = 0$), so it’s always true that</p> \[2xdx + 2y dy = 0\] <p>solving for $dy$ yields</p> \[dy = -\frac{x}{y} dx,\] <p>and so $-x/y$ is our derivative by definition. No funny business!</p> <h3 id="normal-vectors-to-level-curves">Normal Vectors to Level Curves</h3> <p>Something that we often see in optimization is a situation where we have a function $F : \mathbb{R}^n \to \mathbb{R}$ and define a level curve by</p> \[F(x) = C\] <p>for some $C \in \mathbb{R}$. A fact about these level surface is that, at any point $x$, the vector $\nabla F(x)$ is normal to this surface at $x$. This is really useful for many geometric applications——for example, computing projections.</p> <p>I’ve definitely seen some convincing proofs of this, but it’s worth noting that our new machinery makes this fact immediate. Differentiating the constraint and using the Riesz representation theorem yields</p> \[dF = \langle \nabla F, dx \rangle = 0.\] <p>Since $dx$ is constrained to keep $x$ on the level surface, this tells us that, locally, the surface is orthogonal to $\nabla F$, as desired.</p> <h1 id="conclusion">Conclusion</h1> <p>Those are most of my thoughts for the time being. I’d be excited to hear if anyone has thoughts on how to apply these ideas to more interesting problems, or if anyone’s found some issues in the post that I can correct. I’m writing all of this down as I learn it, so I am far from an expert—nevertheless, hopefully this was still useful as an introduction to doing calculus on matrices and beyond!</p> <p>In any case, thanks for reading.</p> <p>—Thomas</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/clfs-and-cbfs/">Lyapunov, Control Lyapunov, and Control Barrier Functions</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/mooc-guide/">A Brief List of MOOCs</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Thomas Kaminsky. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: May 13, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?3e7054dc4d3e3dd8f0731a48453e618e"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?3577194613afa04501eb52f8f4164de9" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{macros:{norm:["{\\left\\lVert #1 \\right\\rVert}",1]},tags:"ams",inlineMath:[["$","$"],["\\(","\\)"]]}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?982c80efc910ea9a6203400dcbd0a3af"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?101922ace415c3a07fdb5a0877aad48f"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let theme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===theme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"Projects",description:"Some of my recent projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-cv",title:"CV",description:"Download my resume using the link, or see a summary of it below.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-teaching",title:"Teaching",description:"Here I list each course that I served on the course staff for, including Course Assistant (CA) or Teaching Fellow (TF).",section:"Navigation",handler:()=>{window.location.href="/teaching/"}},{id:"post-matrix-calculus-or-throw-away-the-matrix-cookbook",title:"Matrix Calculus; Or, Throw Away The Matrix Cookbook!",description:"A brief, non-technical explainer on performing vectorized differentiation.",section:"Posts",handler:()=>{window.location.href="/blog/2025/matrix-calculus/"}},{id:"post-lyapunov-control-lyapunov-and-control-barrier-functions",title:"Lyapunov, Control Lyapunov, and Control Barrier Functions",description:"A brief introduction to Lyapunov theory as I currently understand it.",section:"Posts",handler:()=>{window.location.href="/blog/2024/clfs-and-cbfs/"}},{id:"post-a-brief-list-of-moocs",title:"A Brief List of MOOCs",description:"Some of my favorite hosting sites for online courses, plus some general thoughts about online learning.",section:"Posts",handler:()=>{window.location.href="/blog/2024/mooc-guide/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%74%6B%61%6D%69%6E%73%6B%79@%67.%68%61%72%76%61%72%64.%65%64%75","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/tkaminsky","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/thomas-kaminsky","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/tommy.kamin","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>