<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Lyapunov, Control Lyapunov, and Control Barrier Functions | Thomas Kaminsky </title> <meta name="author" content="Thomas Kaminsky"> <meta name="description" content="A brief introduction to Lyapunov theory as I currently understand it."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/logo.svg?fc378453328c0e5193f1b19498e19c64"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tkaminsky.github.io/blog/2024/clfs-and-cbfs/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Thomas Kaminsky </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lyapunov, Control Lyapunov, and Control Barrier Functions</h1> <p class="post-meta"> Created in November 04, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/lyapunov"> <i class="fa-solid fa-hashtag fa-sm"></i> lyapunov</a>   <a href="/blog/tag/control"> <i class="fa-solid fa-hashtag fa-sm"></i> control</a>   <a href="/blog/tag/dynamical-systems"> <i class="fa-solid fa-hashtag fa-sm"></i> dynamical-systems</a>   ·   <a href="/blog/category/control"> <i class="fa-solid fa-tag fa-sm"></i> control</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Lately, I’ve been running into a lot of work that uses Lyapunov functions to prove statements about the convergence of certain distributed algorithms. I have a limited background in control, and so I initially struggled to wrap my head around these ideas. I also found that it wasn’t super easy to find all of the information that I wanted in a digestible format online. To hopefully begin to remedy this, here is my attempt to give a commonsense explanation of Lyapunov Functions, Control Lyapunov Functions, and Control Barrier Functions, at a level relevant to multi-robot coordination research.</p> <p>This blog post is definitely a work in progress. I’m writing down stuff as I learn it, and at times I include proofs or intuition which aren’t in the source papers, and as such may posess errors. That said, if you have any corrections or other ideas, please feel free to contact me at <code class="language-plaintext highlighter-rouge">tkaminsky@g.harvard.edu</code>.</p> <h3 id="table-of-contents">Table of Contents</h3> <ul> <li><strong><a href="#part-i--lyapunov-functions">Part I: Lyapunov Functions</a></strong></li> <li><strong><a href="#part-ii-control-lyapunov-functions">Part II: Control Lyapunov Functions</a></strong></li> <li><strong><a href="#part-iii--control-barrier-functions">Part III: Control Barrier Functions</a></strong></li> <li><strong><a href="#part-iv--controlling-with-cbfs-and-clfs">Part IV: Controlling with CBFs and CLFs</a></strong></li> <li><strong><a href="#references--further-reading">References and Further Reading</a></strong></li> </ul> <h1 id="part-i--lyapunov-functions">Part I : Lyapunov Functions</h1> <p>Throughout this blog post, we’re working in the world of dynamical systems—that is, we assume that we have access to some system dynamics of the form</p> \[\overset{.}{x}(t) = F(x(t)) \;\; \forall t \in [0,\tau).\] <p>In particular, we care about these dynamics when $x$ is in some neighborhood around $0$, which we define as a set <span class="inlinecode">$\mathcal{D} \in \mathbb{R}^n$</span> such that $0 \in \mathcal{D}$. Let’s engineer $F$ so that $0$ is an <em>equilibrium point</em>, so</p> \[F(0) = 0.\] <p>This means that if $x(t) = 0$, then it will stay there forever, since its time derivative $F(0)=0$. Notice that if some other point $x^{*}$ is an equilibrium point, we can always just construct a shifted dynamics $F’(x) = F(x - x^*)$ so that $0$ is the equilibrium instead, so we just assume for the sake of simplicity that we’ve already shifted the equlibrium to 0. Then our goal is to find out whether this system is <em>stable</em>—that is, whether trajectories $x(t)$ stay close to equilibrium, converge to equlibrium, or converge <em>quickly</em> to equilibrium.</p> <p><a href="https://en.wikipedia.org/wiki/Aleksandr_Lyapunov" rel="external nofollow noopener" target="_blank">Aleksandr Lyapunov</a> (1857-1918) was a Russian mathematician who did a lot of work answering these questions. He defined a a few important notions of stability, including the following three:</p> <ul> <li> <strong>Lyapunov Stability</strong>: $x(t) = 0$ is Lyapunov stable if, for all $\varepsilon &gt; 0$, there exists $\delta &gt; 0$ such that $\norm{x(0)} &lt; \delta \implies \norm{x(t)} &lt; \varepsilon \;\; \forall t$. <ul> <li>Intuitively, a lyapunov-stable solution will stay less than $\varepsilon$-far away from the equlibrium point if we place it $\delta$-far away at initialization.</li> </ul> </li> <li> <strong>Asymptotic Stability</strong>: $x(t) = 0$ is Asymptotically stable if it is Lyapunov stable and, for some $\delta &gt; 0$, if $\norm{x(0)} &lt; \delta$, then $\underset{t \to \infty}{\text{lim}} x(t) = 0$. <ul> <li>That is, in addition to staying ‘close’ to equilibrium, our trajectories actually reach equilibrium in the limit, assuming they start out reasonably close to it.</li> </ul> </li> <li> <strong>Exponential Stability</strong>: $x(t) = 0$ is exponentially stable if there are some $\alpha, \beta, \delta &gt; 0$ such that, if $\norm{x(0)} &lt; \delta$, then $\norm{x(t)} \leq \alpha \norm{x(0)}e^{-\beta t}$ for all $t$. <ul> <li>This looks like asymptotic stability, under the additional constraint that it converges quickly (exponentially-fast) to equilibrium.</li> </ul> </li> </ul> <p>So Lyapunov stability just says that $x(t)$ won’t get ‘too far away’ from $0$, asymptotic stability says that $x(t)$ will eventually reach exactly $x(t) \to 0$, and exponential stability says that $x(t) \to 0$ at an exponential rate.</p> <p>One of the big ideas from Lyapunov theory is that, if we want to figure out whether an equilibrium point satisfies one of these stability conditions, we don’t need to directly look at trajectories ${x(t)}$. Consider for example a pendulum, with equilibrium corresponding to the pendulum being at rest. One way to show that this equilibrium point is (Lyapunov) stable would be to consider the <em>mechanical energy</em> of the system—the sum of the system’s kinetic and potential energies—and show that <em>it</em> is bounded. In particular, we know that the mechanical energy of a closed system must be constant. Thus, if we take the maximum height of our pendelum to be the point where all of the mechanical energy is converted to potential energy (we swing as high as possible, until we have 0 velocity), we know that our pendelum can never swing higher! Thus, we have bounded the possible displacement from equilibrium for our pendelum system.</p> <p>Lyapunov generalizes this idea of the mechanical energy of a system by defining so-called <strong>Lyapunov Functions</strong>. The definition is very general, but in practice this can almost always be thought of as an ‘energy’ at each point in a trajectory:</p> <hr> <h4 id="definition-lyapunov-function"><strong>Definition (Lyapunov Function):</strong></h4> <p>Let $\overset{.}{x}(t) = F(x(t)) $ be a dynamical system with $x(t)=0$ a fixed point, as defined above. Then a continuously differentiable function $V : \mathcal{D} \to \mathbb{R}$ is called a <strong>Lyapunov Function</strong> for the system if the following hold:</p> <ol> <li>$V(0) = 0$.</li> <li>$V(x) &gt; 0 \;\; \forall x \in \mathcal{D} \setminus \{0\}$.</li> <li>The directional derivative $D_xV(x) \cdot \overset{.}{x}(t) = D_x V(x) \cdot F(x(t)) \leq 0$.</li> </ol> <hr> <p>Notice how these properties coincide with our understanding of energy. The first two require that $V$ is only $0$ at equilibrium, and otherwise positive—this reflects our intuition that a trajectory ‘at rest’ in a stable equilibrium should have no kinetic energy and potential energy which could be defined as 0. Any displacement from equilibrium should either result in changing velocity and/or reaching a higher potential energy, so we’d expect non-equilibrium positions to have positive mechanical energy. The final condition thus says that $x(t)$ is always moving towards a lower-energy state (or, at least, not moving to a higher-energy state). If this is true, then we know that our position is never ‘gaining energy’, and so it can only get so far away from its current position.</p> <p>Using Lyapunov functions, we can characterize the stability of equilibrium point. I won’t prove this result (see Haddad et al.’s <a href="https://www.jstor.org/stable/j.ctvcm4hws" rel="external nofollow noopener" target="_blank">textbook</a>, p. 137-140, for details), but the following is an important theorem of Lyapunov:</p> <hr> <h4 id="theorem-lyapunov-stability"><strong>Theorem (Lyapunov Stability).</strong></h4> <p>Let $\overset{\cdot}{x}(t) = F(x(t))$ be a dynamical system defined as above. Then the following hold:</p> <ol> <li> <p>If A Lyapunov function $V$ exists for fixed point $0$, then $x(t) = 0$ is <em>Lyapunov stable</em>.</p> </li> <li> <p>If furthermore \(D_x V(x) \cdot F(x(t)) &lt; 0,\) then the equilibrium is <em>asymptotically stable</em>.</p> </li> <li> <p>Finally, if there are also $\alpha, \beta, \varepsilon &gt;0$, $p \geq 1$ such that</p> <ul> <li>$\alpha \norm{x}^p \leq V(x) \leq \beta \norm{x}^p$, and</li> <li>$D_xV(x) \cdot F(x(t)) \leq -\varepsilon V(x)$,</li> </ul> <p>then the point is <em>exponentially stable</em>.</p> </li> </ol> <hr> <p>Thus, we see that stability can be determined by considering properties of the Lyapunov function, rather than by looking at the trajectory directly! There’s more to say about this, but it seems as though basic Lyapunov theory is pretty well-covered online already. Especially helpful sources for me were Haddad et al.’s textbook <a href="https://www.jstor.org/stable/j.ctvcm4hws" rel="external nofollow noopener" target="_blank">Nonlinear Dynamical Systems and Control: A Lyapunov-Based Approach</a>, Slotine and Li’s textbook <a href="https://lewisgroup.uta.edu/ee5323/notes/Slotine%20and%20Li%20applied%20nonlinear%20control-%20bad%20quality.pdf" rel="external nofollow noopener" target="_blank">Applied Nonlinear Control</a>, and this <a href="https://byjus.com/maths/lyapunov-functions/" rel="external nofollow noopener" target="_blank">blog post</a>.</p> <p>However, there is one final point which is worth thinking about before we move on. In particular, asymptotic stability only requires that there exists <em>some</em> ball $B_\delta(0)$ in which every trajectory converges to 0. It isn’t obvious exactly which balls work for this, and this matters a lot in later sections, when we want to make sure that our system will converge to the equilibrium from a broad range of starting positions.</p> <p>To start to get at this, note that condition (3) of the Lyapunov Function definition implies that the derivative $\frac{d V(x(t))}{dt}$ is non-positive. In other words, $V(x(t))$ is a nonincreasing function. Then we can use the fact that $V(x(t)) \leq V(x(0))$ for all $t$ to make the following statement:</p> <hr> <h4 id="lemma--invariance-of-sublevel-sets-of-lyapunov-functions"><strong>Lemma : Invariance of Sublevel Sets of Lyapunov Functions</strong></h4> <p>Consider any Lyapunov function $V$, and a corresponding <em>sublevel set</em> $S_\beta = \{ x \in \mathbb{R}^n | V(x) \leq \beta \}$ satisfying $S_\beta \subseteq \mathcal{D}$. Then $S_\beta$ is <em>forward-invariant</em>. That is, if $x(0) \in S_\beta$, then $x(t) \in S_\beta $ for all $t$.</p> <p>Moreover, if property $(2)$ of Lyapunov’s Stability Theorem holds, then $x(t) \to 0$ for all $x(0) \in S_\beta$ if either:</p> <ol> <li>$\mathcal{D}$ is bounded, or</li> <li>$V(x)$ is <em>radially unbounded</em>—that is, as $\norm{x}\to\infty$, $V(x) \to \infty$.</li> </ol> <hr> <p><strong><em>Proof</em></strong>.</p> <p>Say that this statement were false. Then, since the trajectory $x(t)$ is continuous, there must exist some time $s$ such that $x(s)$ is not in $S_\beta$. Then, since by construction $V(x(0)) &lt; \beta$ and $V(x(s)) &gt; \beta$, we find</p> \[\frac{ V(x(s)) - V(x(0)) } { s - 0 } := m &gt; \frac{\beta - \beta}{s} = 0.\] <p>Thus, there is some positive secant slope $m$ connecting these two points. But since $V$ and $x$ are both continuously differentiable by construction, $V(x(t))$ is as well, and so we can apply the mean value theorem to find that there must be some time $s_0$ such that</p> \[\frac{d V(x(t))}{dt} = D_xV(x) \cdot F(x(t)) = m &gt; 0,\] <p>which contradicts our definition of a Lyapunov function. Thus, we find that each $S_\beta$ must be forward-invariant.</p> <p>Consider then the second condition (I’m still working on this part: Come back later!).</p> <h1 id="part-ii-control-lyapunov-functions">Part II: Control Lyapunov Functions</h1> <p>For this part, we are going to tweak our setting slightly. Say now that we can apply a <em>control input</em> $u(t)$ which lets us effect the state $x(t)$—for example, say that we had a motor which could supply some force in a direction of our choosing at each timestep. Unless otherwise mentioned, we let $u : \mathcal{D} \to \mathcal{U} \subseteq \mathbb{R}^m$ be a <em>feedback control</em> for our system: that is, $u$ is a function of $x$, $u(x)$ is chosen to apply a correction at point $x$ which pushes it towards equilibrium, and $\mathcal{U}$ is the space of all possible inputs.</p> <p>With this setup, we have a dynamical system which is a function of both the state and control input:</p> \[\overset{.}{x}(t) = F(x(t), u(t)), \;\; \forall t \in [0, \tau).\] <p>Our goal is now to figure out whether our control input will drive the system to equlibrium—or, more ambitiously, to somehow derive an optimal controller for this dynamical system.</p> <p>One naive approach is to just choose some feedback controller $u(x)$ and let $\overset{\sim}{x} := [x,u(x)]$ be a new state vector. Then</p> \[\overset{.}{\overset{\sim}{x}}(t) = \overset{\sim}{F}(\overset{\sim}{x}(t)) := F(x(t), u(x))\] <p>is a dynamical system which can be analyzed using the usual Lyapunov functions from <a href="#part-i--lyapunov-functions">Part I</a>. However, this methodology has some major problems. Most pressingly, if it’s <em>hard</em> to randomly pick a $u(x)$ that stabilizes the system, then we have no way to figure out ‘good’ choices of $u$ other than just by plugging in a ton of options. This motivates Control Lyapunov Functions—we want to create an object which can allow us to <em>locate</em> good controls for a given problem.</p> <p>We formally define a Control Lyapunov Function as follows:</p> <hr> <h4 id="definition-control-lyapunov-function-clf"><strong>Definition (Control Lyapunov Function (CLF)):</strong></h4> <p>Let $F(x(t), u(t))$ be a controlled dynamical system defined as above. Then a continuously differentiable function $V: \mathcal{D} \to \mathbb{R}$ is called a control Lyapunov function for the system if the following hold:</p> <ol> <li>$V(0) = 0$.</li> <li>$V(x) &gt; 0 \;\; \forall x \in \mathcal{D} \setminus {0}$.</li> <li>$ \underset{u \in \mathcal{U}}{\inf} \; D_xV(x) \cdot F(x, u) &lt; 0$ for all $x \in \mathcal{D} \setminus {0}$.</li> </ol> <hr> <p>The first two conditions are identical to a normal Lyapunov function. The third is a little stranger. It requres that, for every point $x$, there exists some control input $u$ that causes the directional derivative to be negative. We can think of this as implying the existence of a stabilizing feedback controller. In particular, taking</p> \[u^*(x) \in \{u \in \mathcal{U} | D_xV(x) \cdot F(x,u) &lt; 0\} \;\; \forall x \in \mathcal{D},\] <p>where each of these sets is guaranteed to be nonempty by condition (3), we find that the dynamical system</p> \[\overset{.}{x}(t) = F(x(t), u^*(x(t)))\] <p>is asymptotically stable, since $V$ is a Lyapunov function satisfying criterion (2) from Lyapunov’s Stability Theorem. Conversely, if condition (3) is not met, then there must be some $x$ such that NO control can stabilize it, and so there does not exist a stable controller. Thus, we can interpret the existence of a CLF as a necessary and sufficient condition for the dynamical system to be asymptotically stabilizable using a feedback controller. We summarize this in the following theorem:</p> <hr> <h4 id="theorem-stability-of-controlled-systems"><strong>Theorem (Stability of Controlled Systems)</strong></h4> <p>Let $\overset{.}{x}(t) = F(x(t),u)$ be a controlled dynamical system defined as above. Then this system is asymptotically stabilizable by a feedback controller if and only if there exists a Control Lyapunov Function for the system.</p> <hr> <p>Now, in some sense, we’ve solved our problem of characterizing optimal controllers. If we can develop an algorithm which can sample members of $\{u \in \mathcal{U} | D_xV(x) \cdot F(x,u) &lt; 0\}$, then we can use this scheme to create a controller. However, it is not always clear how to do this in practice. In the following section, we identify a strategy for calculating optimal controllers in the special case of a linear controller.</p> <h3 id="special-case--linear-control">Special Case : Linear Control</h3> <p>Assume that we are working with an <em>affine control system</em> governed my the dynamics</p> \[\overset{.}{x}(t) = F(x(t)) + G(x(t)) u(t) \;\; \forall t \in [0,\tau)\] <p>for some $F : \mathbb{R}^n \to \mathbb{R}^n$ and $G: \mathbb{R}^n \to \mathbb{R}^{n \times m}$, both smooth. Assume also for the time being that the control space \(\mathcal{U} = \mathbb{R}^m\). For a simple example of such a system, say that $G(x) = I$ for all $x$. Then at each time our control input corresponds to moving the agent in any direction.</p> <p>In this setting, we can make a stronger statement about the existence of optimal control:</p> <hr> <h4 id="theorem-affine-control-lyapunov-function"><strong>Theorem (Affine Control Lyapunov Function)</strong></h4> <p>Under an affine control system $\overset{.}{x}(t) = F(x(t)) + G(x(t)) u(t)$ defined as above, a positive-definite, radially unbounded function $V:\mathbb{R}^n \to \mathbb{R}$ is a Control Lyapunov Function if and only if</p> \[D_xV(x) \cdot F(x(t)) &lt; 0 \;\; \forall x \in \mathcal{R},\] <p>where</p> \[\mathcal{R} := \{x \in \mathbb{R}^n | x \neq 0, D_xV(x) \cdot G(x(t)) = \mathbf{0}\}.\] <hr> <p><em><strong>Proof.</strong></em></p> <p>Consider condition (3) of a CLF, that is:</p> <p>$ \underset{u \in \mathcal{U}}{\inf} \; D_xV(x) \cdot F(x, u) &lt; 0$ for all $x \in \mathcal{D} \setminus \{0\}.$</p> <p>By plugging in the affine control to this expression, we see that it’s equivalent to</p> \[\underset{u \in \mathcal{U}}{\inf} \; D_xV(x) \cdot [F(x(t)) + G(x(t)) u(t)]\] \[= \underset{u \in \mathcal{U}}{\inf} \; \left[ D_xV(x) \cdot F(x(t)) + D_xV(x) \cdot G(x(t)) u(t) \right].\] <p>If $D_xV(x) \cdot G(x(t)) \neq \mathbf{0}$, then there must be some non-zero entry at index $i$ with sign $\varepsilon$. Then taking $u_i \to -\varepsilon \cdot \infty$, we see that the entire expression can approach $-\infty &lt; 0$.</p> <p>Thus, the only conditions that we care about occur when $D_xV(x) \cdot G(x(t)) = \mathbf{0}$—that is, for points in $\mathcal{R}$. In these cases, we require that</p> \[\underset{u \in \mathcal{U}}{\inf} \; D_xV(x) \cdot F(x(t)) &lt; 0,\] <p>which is exactly our result.</p> <p>With this lemma, we can explicitly design a controller which globally (for any $x \in \mathbb{R}$ stabilizes our system). We define the following controller:</p> <hr> <h4 id="theorem--linear-feedback-controller"><strong>Theorem : Linear Feedback Controller</strong></h4> <p>For the affine control system $\overset{.}{x}(t)=F(x(t))+G(x(t)) u(t)$ defined above, there exists a feedback controller $\phi : \mathbb{R}^n \to \mathbb{R}^m$ given by the following:</p> \[\phi(x) = \begin{cases} - \left( c_0 + \frac{\alpha(x) + \sqrt{\alpha^2(x) + \left[ \beta^T(x) \beta(x) \right]^2}}{\beta^T(x) \beta(x)} \right) \beta(x), &amp; \beta(x) \neq 0, \\ 0 &amp; \beta(x) = 0, \end{cases}\] <p>where $c_0 \geq 0$ is any scalar,</p> \[\alpha(x) := D_xV(x) \cdot F(x),\] <p>and</p> \[\beta(x) := \left[ D_xV(x) \cdot G(x) \right]^T.\] <hr> <p><strong><em>Proof.</em></strong></p> <p>We just plug into</p> \[D_xV(x) \cdot [F(x) + G(x) \phi(x)] = \alpha(x) + \beta^T(x) \phi(x).\] <p>If $\beta(x) = 0$, then we find $D_xV(x) = D_xV(x) \cdot F(x) &lt; 0$ by the Affine Control Lyapunov Theorem.</p> <p>Otherwise, we substitute in $\phi$ to find</p> \[= \alpha(x) - \beta^T(x) \beta(x) \left( c_0 + \frac{\alpha(x) + \sqrt{\alpha^2(x) + \left[ \beta^T(x) \beta(x) \right]^2}}{\beta^T(x) \beta(x)} \right)\] \[= -\beta^T(x) \beta(x) c_0 - \sqrt{\alpha^2(x) + \left[ \beta^T(x) \beta(x) \right]^2} &lt; 0,\] <p>since both of these terms are negative by construction. Thus, we find that the derivative is negative, and so this is indeed a stabilizing controller.</p> <p>But what’s happening here intuitively? Consider for simplicity when $c_0 = 0$.</p> <p>Then let’s consider two examples. First, say that $G(x) = I$; that is, we just move in direction $u$. Then $\beta(x) = D_xV(x)$, so our control input has us move in the direction of steepest descent in $V$. This looks like a gradient descent! We have some ‘strength’ given by the big constant term, which we then apply to the direction which moves us towards equilibrium the fastest. Notice that our construction ensures that our derivative $\frac{d V(x(t))}{dt}$ is $-\sqrt{\alpha^2(x) + \norm{\beta}^4}$. So we see that this is the rate at which we will move down $V$.</p> <p>As another example, say that we have a more constrained $G$ given by $G(x) = [1,0]^T$. Then our control input is a one-dimensional displacement in the $x$ axis. Then $\beta(x) = \frac{d V(x)}{d x_1}$. Thus, our optimal control has us moving in the direction that decreases $V$ as much as possible, given that we can only control along the $x$ axis. Namely, if the partial along the $x$ axis is positive, we move in the negative direction, and vice-versa. Thus, we see that this looks like a constrained version of the previous example,</p> <p>Thus, we find that we can create optimal feedback controllers for affine systems.</p> <h3 id="note--local-stabilizability">Note : Local Stabilizability</h3> <p>One question that seems relevant is, what if we can’t assume that $\mathcal{U} = \mathbb{R}^m$? I’ll fill this in later (Section TBD), but I think that the main idea is that obviously global stability could fail, because we might get too far away from the equilibrium to reasonably control there. However, if we are operating in a bounded set $\mathcal{D}$, then under certain regularity assumptions (like that everything we care about is Lipschitz on $\mathcal{D}$), we can bound the size of the optimal controller given above. Thus, we can create a controller constrained to $\mathcal{U}$ which is optimal, and perhaps we can even say the ‘weakest’ controller which can still work!</p> <h1 id="part-iii--control-barrier-functions">Part III : Control Barrier Functions</h1> <p>Thus far, we have mostly been concerned with studying the <em>stability</em> of equilibria and controlled equilibria. However, there are often other concerns worth accounting for during planning.</p> <p>In this section, we consider <em>safety</em> concerns in dynamical systems. In particular, it is possible that some $x(t)$ are ‘bad’ states—for example, some orientations of a robotic arm could cause it to hit an object, or an autonomous vehicle being in certain regions of space could be dangerous if those regions are also occupied by humans. In general, we could imagine assigning a ‘badness’ score to every point in our state space, with negative badness scores being avoided. Then we could cast the problem of ensuring safety as enforcing that we remain in ‘good’ zones; that is, those with positive score.</p> <p>This idea enables us to define a <em>Barrier Function</em> (technically, a Zeroing Barrier Function, see <a href="https://ieeexplore.ieee.org/abstract/document/7782377?casa_token=Su26OE1ZV1EAAAAA:KMlvhbhQq0wb76ixit1QMQgIVqZEQj8Vf4fTlfewe5_auWi48Zb-nSSJ7mxopBuDgF0bLT3BHw" rel="external nofollow noopener" target="_blank">Ames et al.</a>):</p> <hr> <h4 id="definition--barrier-function"><strong>Definition : Barrier Function</strong></h4> <p>A continuously differentiable function $h : \mathcal{D} \to \mathbb{R}$ is called a <em>Barrier Function</em> for $\mathcal{C} = \{ x\in \mathbb{R}^n | h(x) \geq 0 \}$ if $\mathcal{C} \subseteq \mathcal{D}$ and there exists some strictly increasing function $\alpha : \mathbb{R} \to \mathbb{R}$ with $\alpha(0) = 0$ such that</p> \[\frac{d h(x(t))}{d t} = D_xh(x) \cdot F(x) \geq -\alpha(h(x)).\] <hr> <p>This definition implies that, at the boundary $\partial \mathcal{C} = \{x \in \mathbb{R}^n | h(x) = 0 \}$,</p> \[\frac{d h(x(t))}{d t} \geq -\alpha(0) = 0,\] <p>so $h(x)$ will not leave $\mathcal{C}$ if it is already inside it. Thus, we see that this definition enforces forward invariance as we desire. In fact, we can actually get an even stronger condition. Decause $\alpha$ is strictly increasing, if we are outside of our set $\mathcal{C}$, then we find that</p> \[\frac{d h(x(t))}{d t} \geq -\alpha(0) &gt; 0,\] <p>so we will be travelling towards $\mathcal{C}$ whenever we are outside of it. This can be formalized as a Lyapunov function as follows:</p> <hr> <h4 id="theorem--bf-to-lyapunov-function"><strong>Theorem : BF to Lyapunov Function</strong></h4> <p>Say that $h(x)$ is a Barrier Function for $\mathcal{C}$ with domain $\mathcal{D}$. Then define $V_\mathcal{C}$ as follows:</p> \[V_\mathcal{C}(x) = \begin{cases} 0, &amp; \text{ if } x \in \mathcal{C},\\ -h(x) &amp; \text{ if } x \in \mathcal{D} \setminus \mathcal{C}. \end{cases}\] <p>$V_\mathcal{C}$ is a Lyapunov function for our problem. Moreover, $\mathcal{C}$ is an asymptotically stable fixed set.</p> <hr> <p>Here we generalize a Lyapunov function to a set, rather than a particular point—this causes no real issues, but it is a worthwhile exercise to make sure that everything still makes sense when we do this replacement.</p> <p>It actually turns out that the converse of this theorem is also true if $\mathcal{C}$ is nonempty and compact. That is, we also have that $\mathcal{C}$ is a forward-invariant set if and only if you can create a barrier function for it!</p> <p>However, Barrier Functions don’t allow us to steer our dynamical system to safe regions. To do this, assume now that we are in an affine control system</p> \[\overset{.}{x}(t) = F(x(t)) + G(x(t)) u(t) \;\; \forall t \in [0,\tau)\] <p>analogously to defining CLFs from LFs, we define the notion of a <em>Control Barrier Function</em>:</p> <hr> <h4 id="definition--control-barrier-function"><strong>Definition : Control Barrier Function</strong></h4> <p>A continuously differentiable function $h : \mathcal{D} \to \mathbb{R}$ is called a <em>Control Barrier Function</em> for $\mathcal{C} = \{ x\in \mathbb{R}^n | h(x) \geq 0 \}$ if $\mathcal{C} \subseteq \mathcal{D}$ and there exists some strictly increasing function $\alpha : \mathbb{R} \to \mathbb{R}$ with $\alpha(0) = 0$ such that</p> \[\underset{u \in \mathcal{U}}{\text{sup}} \frac{d h(x(t))}{d t} = \underset{u \in \mathcal{U}}{\text{sup}} D_xh(x) \cdot F(x) + D_x h(x) \cdot G(x) u \geq -\alpha(h(x)).\] <hr> <p>This looks really similar to our definition of the CLF. Now, we see that there must exist some control input that will render each induce a barrier function when the corresponding control is substituted in. The analysis here is exactly the same as in the CLF case (indeed, we can define a CLF as in the previous section as the negation of our CBF), so we omit it here. The important thing is that we can design a control which allows us to ensure that we remain in a safe set.</p> <h1 id="part-iv--controlling-with-cbfs-and-clfs">Part IV : Controlling With CBFs and CLFs</h1> <p>Let’s tie this all together by defining concrete</p> <p>First, say that we are given a target feedback controller $\phi(x)$. We want to derive a controller $u$ which is as close to $\phi$ as possible, but with the added constraint that it must be safe with respect to some set $\mathcal{C}$. We can get this by solving the <a href="https://en.wikipedia.org/wiki/Quadratic_programming" rel="external nofollow noopener" target="_blank">Quadratic Program</a> (QP):</p> \[\begin{align*} u(x) &amp;= \underset{u \in \mathcal{U}}{\text{arg min}} \frac{1}{2} \norm{u - \phi(x)}^2 \\ &amp; \text{ s.t. } D_xh(x) \cdot F(x) + D_x h(x) \cdot u \geq -\alpha (h(x)). \end{align*}.\] <p>According to work outside the scope of this blog post (see <a href="https://coogan.ece.gatech.edu/papers/pdf/amesecc19.pdf" rel="external nofollow noopener" target="_blank">Ames et al., 2019.</a>), this problem has a closed-form solution when $\mathcal{U} = \mathbb{R}^n$.</p> <p>More generally, we can use this strategy to assign a controller that both stabilizes the system (as determined by some CLF $V$) AND offers safety guaranteed by $h$. In particular, the following QP works:</p> \[\begin{align*} u(x) &amp;= \underset{(u, \delta) \in \mathbb{R}^{m+1}}{\text{arg min}} \frac{1}{2} u^T H(x) u + p \delta^2 \\ &amp; \text{ s.t. } D_x V(x) \cdot F(x) + D_x V(x) \cdot u \leq -\gamma (V(x)) + \delta\\ &amp; D_xh(x) \cdot F(x) + D_x h(x) \cdot u \geq -\alpha (h(x)), \end{align*}\] <p>where $\gamma$ is another class $\mathcal{K}$ function, $H(x)$ is any positive definite matrix (so that term drives $\norm{u} \to 0$) and $\delta$ is a relaxation parameter which ensures that the program is solvable. Having the term $p \delta^2$ in the constraint drives this relaxation to $0$. The solution to this problem is guaranteed to be safe, and is likely to be stable (more so as we take $\delta \to 0$).</p> <h1 id="conclusion">Conclusion</h1> <p>Thus, we find that the problem of controlling subject to some safety constraint, or optimally controlling with both a stability and safety objective, can be achieved using CLFs and CBFs, and solved using existing tools for Quadratic Programming. For example, see the <a href="https://www.ll.mit.edu/partner-us/available-technologies/control-barrier-function-toolbox" rel="external nofollow noopener" target="_blank">Control Barrier Function Toolbox</a> from Lincoln Labs.</p> <p>It is perhaps worthwhile to see some concrete examples of CLFs and CBFs in the wild. I plan to cover this in a future blog post, focusing in particular on a paper out of my lab (<a href="https://ieeexplore.ieee.org/abstract/document/10354416?casa_token=6jyiwNV7sCEAAAAA:5BLuAUeRw1ZmuZaxHnD_YfWKkL0wZqbVP8pHQNU8xamrJAbb9cJMJGvkxzNIYrNsIZ59Or0" rel="external nofollow noopener" target="_blank">Cavorsi et al., 2023. </a>).</p> <p>In any case, thanks for reading.</p> <p>—Thomas</p> <h1 id="references--further-reading">References + Further Reading</h1> <p>Here are a few of the books and papers that I found especially helpful. Especially clear writing is marked in <strong>bold</strong>.</p> <h4 id="textbooks">Textbooks:</h4> <ul> <li> <p><a href="https://lewisgroup.uta.edu/ee5323/notes/Slotine%20and%20Li%20applied%20nonlinear%20control-%20bad%20quality.pdf" rel="external nofollow noopener" target="_blank">Slotine and Li, 1991. Applied Nonlinear Control</a></p> </li> <li> <p><strong><a href="https://www.jstor.org/stable/j.ctvcm4hws" rel="external nofollow noopener" target="_blank">Haddad and Chellaboina, 2008. Nonlinear Dynamical Systems and Control: A Lyapunov-Based Approach</a></strong></p> </li> </ul> <h4 id="papers-chronological">Papers (Chronological):</h4> <ul> <li> <p><a href="https://www.sciencedirect.com/science/article/pii/0362546X83900494" rel="external nofollow noopener" target="_blank">Artstein, 1982. Stabilization with Relaxed Controls</a></p> </li> <li> <p><a href="https://epubs.siam.org/doi/abs/10.1137/0321028?casa_token=UBCu6QQcDNQAAAAA:gnQ5sEIIyS-uXT8bzuob6UIffSQjAbhfVmpw8qx_cxOJ-RmMJT25gE1Hb5iwxCJqXlYsIl9J" rel="external nofollow noopener" target="_blank">Sontag, 1983. A Lyapunov-Like Characterization of Asymptotic Controllability</a></p> </li> <li> <p><a href="http://www.sontaglab.org/FTPDIR/art-sycon8903.pdf" rel="external nofollow noopener" target="_blank">Sontag, 1989. A ‘Universal’ Construction of Artstein’s Theorem on Nonlinear Stabilization</a></p> </li> <li> <p><strong><a href="https://ieeexplore.ieee.org/abstract/document/7782377?casa_token=Su26OE1ZV1EAAAAA:KMlvhbhQq0wb76ixit1QMQgIVqZEQj8Vf4fTlfewe5_auWi48Zb-nSSJ7mxopBuDgF0bLT3BHw" rel="external nofollow noopener" target="_blank">Ames et al., 2016. Control Barrier Function Based Quadratic Programs for Safety Critical Systems</a></strong></p> </li> <li> <p><a href="https://coogan.ece.gatech.edu/papers/pdf/amesecc19.pdf" rel="external nofollow noopener" target="_blank">Ames et al., 2019. Control Barrier Functions: Theory and Applications</a></p> </li> <li> <p><a href="https://ieeexplore.ieee.org/abstract/document/9197109?casa_token=HEt2jergrKEAAAAA:oStQJxHycKbc4iCHloCpSi62P8oWoPqILA4k_tcUEYNrMS76EK40c4lyLcJSjdBnA5LlL7E" rel="external nofollow noopener" target="_blank">Capelli et al., 2020. Connectivity Maintenance: Global and Optimized Approach Through Control Barrier Functions</a></p> </li> <li> <p><a href="https://ieeexplore.ieee.org/abstract/document/10354416?casa_token=6jyiwNV7sCEAAAAA:5BLuAUeRw1ZmuZaxHnD_YfWKkL0wZqbVP8pHQNU8xamrJAbb9cJMJGvkxzNIYrNsIZ59Or0" rel="external nofollow noopener" target="_blank">Cavorsi et al., 2023. Multirobot Adversarial Resilience Using Control Barrier Functions</a></p> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/mooc-guide/">A Brief List of MOOCs</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Thomas Kaminsky. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: November 06, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{macros:{norm:["{\\left\\lVert #1 \\right\\rVert}",1]},tags:"ams",inlineMath:[["$","$"],["\\(","\\)"]]}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let theme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===theme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"Projects",description:"Some of my recent projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-cv",title:"CV",description:"Download my resume using the link, or see a summary of it below.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-teaching",title:"Teaching",description:"Here I list each course that I served on the course staff for, including Course Assistant (CA) or Teaching Fellow (TF).",section:"Navigation",handler:()=>{window.location.href="/teaching/"}},{id:"post-lyapunov-control-lyapunov-and-control-barrier-functions",title:"Lyapunov, Control Lyapunov, and Control Barrier Functions",description:"A brief introduction to Lyapunov theory as I currently understand it.",section:"Posts",handler:()=>{window.location.href="/blog/2024/clfs-and-cbfs/"}},{id:"post-a-brief-list-of-moocs",title:"A Brief List of MOOCs",description:"Some of my favorite hosting sites for online courses, plus some general thoughts about online learning.",section:"Posts",handler:()=>{window.location.href="/blog/2024/mooc-guide/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%74%6B%61%6D%69%6E%73%6B%79@%67.%68%61%72%76%61%72%64.%65%64%75","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/tkaminsky","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/thomas-kaminsky","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/tommy.kamin","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>